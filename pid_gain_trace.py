
"""
PID 게인값 적용 과정 추적 예제

이 코드는 첫 5번의 반복을 자세히 출력해서
게인값이 어떻게 작동하는지 보여줍니다.
"""

import numpy as np

# PID 게인값 설정
Kp = 5.0
Ki = 0.1
Kd = 0.5

# 초기 상태
target_temp = 200  # 목표 온도
current_temp = 25  # 현재 온도
integral = 0       # 적분 누적값
prev_error = 0     # 이전 오차
dt = 0.1          # 시간 간격

# 시스템 파라미터
heat_capacity = 5.0
cooling_rate = 0.03
ambient_temp = 25

print("="*80)
print("PID 게인값 적용 과정 추적")
print("="*80)
print(f"설정: Kp={Kp}, Ki={Ki}, Kd={Kd}")
print(f"목표 온도: {target_temp}°C")
print(f"초기 온도: {current_temp}°C\n")

# 첫 5번의 반복 추적
for i in range(5):
    print(f"{'='*80}")
    print(f"반복 {i+1} (시간: {i*dt:.1f}초)")
    print(f"{'='*80}")
    
    # Step 1: 오차 계산
    error = target_temp - current_temp
    print(f"\n[Step 1] 오차 계산")
    print(f"  오차 = 목표({target_temp}°C) - 현재({current_temp:.2f}°C) = {error:.2f}°C")
    
    # Step 2-1: P항 계산
    P = Kp * error
    print(f"\n[Step 2-1] P항 (비례) 계산")
    print(f"  P = Kp × 오차")
    print(f"  P = {Kp} × {error:.2f} = {P:.2f}")
    print(f"  → 오차가 크면 큰 출력!")
    
    # Step 2-2: I항 계산
    integral += error * dt
    I = Ki * integral
    print(f"\n[Step 2-2] I항 (적분) 계산")
    print(f"  누적 오차 = {integral:.2f}")
    print(f"  I = Ki × 누적오차")
    print(f"  I = {Ki} × {integral:.2f} = {I:.2f}")
    print(f"  → 과거 오차를 모두 합산!")
    
    # Step 2-3: D항 계산
    derivative = (error - prev_error) / dt if dt > 0 else 0
    D = Kd * derivative
    print(f"\n[Step 2-3] D항 (미분) 계산")
    print(f"  오차 변화율 = (현재 오차 - 이전 오차) / 시간")
    print(f"  오차 변화율 = ({error:.2f} - {prev_error:.2f}) / {dt} = {derivative:.2f}")
    print(f"  D = Kd × 변화율")
    print(f"  D = {Kd} × {derivative:.2f} = {D:.2f}")
    if derivative > 0:
        print(f"  → 오차가 증가 중 (온도가 멀어짐)")
    elif derivative < 0:
        print(f"  → 오차가 감소 중 (온도가 가까워짐, 브레이크!)")
    else:
        print(f"  → 오차 변화 없음")
    
    # Step 2-4: 최종 PID 출력
    output = P + I + D
    print(f"\n[Step 2-4] PID 최종 출력")
    print(f"  output = P + I + D")
    print(f"  output = {P:.2f} + {I:.2f} + {D:.2f} = {output:.2f}")
    
    # Step 3: 히터 출력 제한
    heater_power = np.clip(output, 0, 100)
    print(f"\n[Step 3] 히터 출력 제한")
    print(f"  원래 출력: {output:.2f}")
    print(f"  제한 후: {heater_power:.2f}% (0~100% 범위)")
    if output > 100:
        print(f"  ⚠️ 100%를 초과해서 100%로 제한됨")
    
    # Step 4: 온도 변화 계산
    heating = heater_power / heat_capacity
    cooling = cooling_rate * (current_temp - ambient_temp)
    temp_change = (heating - cooling) * dt
    new_temp = current_temp + temp_change
    
    print(f"\n[Step 4] 온도 변화")
    print(f"  가열량 = 히터출력 / 열용량")
    print(f"  가열량 = {heater_power:.2f} / {heat_capacity} = {heating:.2f} °C/초")
    print(f"  냉각량 = 냉각속도 × (현재온도 - 주변온도)")
    print(f"  냉각량 = {cooling_rate} × ({current_temp:.2f} - {ambient_temp}) = {cooling:.2f} °C/초")
    print(f"  순변화 = (가열 - 냉각) × 시간")
    print(f"  순변화 = ({heating:.2f} - {cooling:.2f}) × {dt} = {temp_change:.2f}°C")
    print(f"  새 온도 = {current_temp:.2f} + {temp_change:.2f} = {new_temp:.2f}°C")
    
    # 각 항의 기여도 표시
    print(f"\n[기여도 분석]")
    total = abs(P) + abs(I) + abs(D)
    if total > 0:
        print(f"  P항: {abs(P)/total*100:.1f}%")
        print(f"  I항: {abs(I)/total*100:.1f}%")
        print(f"  D항: {abs(D)/total*100:.1f}%")
    
    # 다음 반복을 위한 업데이트
    prev_error = error
    current_temp = new_temp
    
    print(f"\n→ 다음 반복으로 이동...\n")

print("="*80)
print("5번 반복 완료!")
print("="*80)
print(f"최종 온도: {current_temp:.2f}°C (목표: {target_temp}°C)")
print(f"남은 오차: {target_temp - current_temp:.2f}°C")
print("\n이런 식으로 3000번 반복하면 목표 온도에 도달합니다!")







"""
--------------------------------------------------------------------------------------



아래부터는 출력 결과 입니다.




================================================================================
PID 게인값 적용 과정 추적
================================================================================
설정: Kp=5.0, Ki=0.1, Kd=0.5
목표 온도: 200°C
초기 온도: 25°C

================================================================================
반복 1 (시간: 0.0초)
================================================================================

[Step 1] 오차 계산
  오차 = 목표(200°C) - 현재(25.00°C) = 175.00°C

[Step 2-1] P항 (비례) 계산
  P = Kp × 오차
  P = 5.0 × 175.00 = 875.00
  → 오차가 크면 큰 출력!

[Step 2-2] I항 (적분) 계산
  누적 오차 = 17.50
  I = Ki × 누적오차
  I = 0.1 × 17.50 = 1.75
  → 과거 오차를 모두 합산!

[Step 2-3] D항 (미분) 계산
  오차 변화율 = (현재 오차 - 이전 오차) / 시간
  오차 변화율 = (175.00 - 0.00) / 0.1 = 1750.00
  D = Kd × 변화율
  D = 0.5 × 1750.00 = 875.00
  → 오차가 증가 중 (온도가 멀어짐)

[Step 2-4] PID 최종 출력
  output = P + I + D
  output = 875.00 + 1.75 + 875.00 = 1751.75

[Step 3] 히터 출력 제한
  원래 출력: 1751.75
  제한 후: 100.00% (0~100% 범위)
  ⚠️ 100%를 초과해서 100%로 제한됨

[Step 4] 온도 변화
  가열량 = 히터출력 / 열용량
  가열량 = 100.00 / 5.0 = 20.00 °C/초
  냉각량 = 냉각속도 × (현재온도 - 주변온도)
  냉각량 = 0.03 × (25.00 - 25) = 0.00 °C/초
  순변화 = (가열 - 냉각) × 시간
  순변화 = (20.00 - 0.00) × 0.1 = 2.00°C
  새 온도 = 25.00 + 2.00 = 27.00°C

[기여도 분석]
  P항: 50.0%
  I항: 0.1%
  D항: 50.0%

→ 다음 반복으로 이동...

================================================================================
반복 2 (시간: 0.1초)
================================================================================

[Step 1] 오차 계산
  오차 = 목표(200°C) - 현재(27.00°C) = 173.00°C

[Step 2-1] P항 (비례) 계산
  P = Kp × 오차
  P = 5.0 × 173.00 = 865.00
  → 오차가 크면 큰 출력!

[Step 2-2] I항 (적분) 계산
  누적 오차 = 34.80
  I = Ki × 누적오차
  I = 0.1 × 34.80 = 3.48
  → 과거 오차를 모두 합산!

[Step 2-3] D항 (미분) 계산
  오차 변화율 = (현재 오차 - 이전 오차) / 시간
  오차 변화율 = (173.00 - 175.00) / 0.1 = -20.00
  D = Kd × 변화율
  D = 0.5 × -20.00 = -10.00
  → 오차가 감소 중 (온도가 가까워짐, 브레이크!)

[Step 2-4] PID 최종 출력
  output = P + I + D
  output = 865.00 + 3.48 + -10.00 = 858.48

[Step 3] 히터 출력 제한
  원래 출력: 858.48
  제한 후: 100.00% (0~100% 범위)
  ⚠️ 100%를 초과해서 100%로 제한됨

[Step 4] 온도 변화
  가열량 = 히터출력 / 열용량
  가열량 = 100.00 / 5.0 = 20.00 °C/초
  냉각량 = 냉각속도 × (현재온도 - 주변온도)
  냉각량 = 0.03 × (27.00 - 25) = 0.06 °C/초
  순변화 = (가열 - 냉각) × 시간
  순변화 = (20.00 - 0.06) × 0.1 = 1.99°C
  새 온도 = 27.00 + 1.99 = 28.99°C

[기여도 분석]
  P항: 98.5%
  I항: 0.4%
  D항: 1.1%

→ 다음 반복으로 이동...

================================================================================
반복 3 (시간: 0.2초)
================================================================================

[Step 1] 오차 계산
  오차 = 목표(200°C) - 현재(28.99°C) = 171.01°C

[Step 2-1] P항 (비례) 계산
  P = Kp × 오차
  P = 5.0 × 171.01 = 855.03
  → 오차가 크면 큰 출력!

[Step 2-2] I항 (적분) 계산
  누적 오차 = 51.90
  I = Ki × 누적오차
  I = 0.1 × 51.90 = 5.19
  → 과거 오차를 모두 합산!

[Step 2-3] D항 (미분) 계산
  오차 변화율 = (현재 오차 - 이전 오차) / 시간
  오차 변화율 = (171.01 - 173.00) / 0.1 = -19.94
  D = Kd × 변화율
  D = 0.5 × -19.94 = -9.97
  → 오차가 감소 중 (온도가 가까워짐, 브레이크!)

[Step 2-4] PID 최종 출력
  output = P + I + D
  output = 855.03 + 5.19 + -9.97 = 850.25

[Step 3] 히터 출력 제한
  원래 출력: 850.25
  제한 후: 100.00% (0~100% 범위)
  ⚠️ 100%를 초과해서 100%로 제한됨

[Step 4] 온도 변화
  가열량 = 히터출력 / 열용량
  가열량 = 100.00 / 5.0 = 20.00 °C/초
  냉각량 = 냉각속도 × (현재온도 - 주변온도)
  냉각량 = 0.03 × (28.99 - 25) = 0.12 °C/초
  순변화 = (가열 - 냉각) × 시간
  순변화 = (20.00 - 0.12) × 0.1 = 1.99°C
  새 온도 = 28.99 + 1.99 = 30.98°C

[기여도 분석]
  P항: 98.3%
  I항: 0.6%
  D항: 1.1%

→ 다음 반복으로 이동...

================================================================================
반복 4 (시간: 0.3초)
================================================================================

[Step 1] 오차 계산
  오차 = 목표(200°C) - 현재(30.98°C) = 169.02°C

[Step 2-1] P항 (비례) 계산
  P = Kp × 오차
  P = 5.0 × 169.02 = 845.09
  → 오차가 크면 큰 출력!

[Step 2-2] I항 (적분) 계산
  누적 오차 = 68.80
  I = Ki × 누적오차
  I = 0.1 × 68.80 = 6.88
  → 과거 오차를 모두 합산!

[Step 2-3] D항 (미분) 계산
  오차 변화율 = (현재 오차 - 이전 오차) / 시간
  오차 변화율 = (169.02 - 171.01) / 0.1 = -19.88
  D = Kd × 변화율
  D = 0.5 × -19.88 = -9.94
  → 오차가 감소 중 (온도가 가까워짐, 브레이크!)

[Step 2-4] PID 최종 출력
  output = P + I + D
  output = 845.09 + 6.88 + -9.94 = 842.03

[Step 3] 히터 출력 제한
  원래 출력: 842.03
  제한 후: 100.00% (0~100% 범위)
  ⚠️ 100%를 초과해서 100%로 제한됨

[Step 4] 온도 변화
  가열량 = 히터출력 / 열용량
  가열량 = 100.00 / 5.0 = 20.00 °C/초
  냉각량 = 냉각속도 × (현재온도 - 주변온도)
  냉각량 = 0.03 × (30.98 - 25) = 0.18 °C/초
  순변화 = (가열 - 냉각) × 시간
  순변화 = (20.00 - 0.18) × 0.1 = 1.98°C
  새 온도 = 30.98 + 1.98 = 32.96°C

[기여도 분석]
  P항: 98.0%
  I항: 0.8%
  D항: 1.2%

→ 다음 반복으로 이동...

================================================================================
반복 5 (시간: 0.4초)
================================================================================

[Step 1] 오차 계산
  오차 = 목표(200°C) - 현재(32.96°C) = 167.04°C

[Step 2-1] P항 (비례) 계산
  P = Kp × 오차
  P = 5.0 × 167.04 = 835.18
  → 오차가 크면 큰 출력!

[Step 2-2] I항 (적분) 계산
  누적 오차 = 85.51
  I = Ki × 누적오차
  I = 0.1 × 85.51 = 8.55
  → 과거 오차를 모두 합산!

[Step 2-3] D항 (미분) 계산
  오차 변화율 = (현재 오차 - 이전 오차) / 시간
  오차 변화율 = (167.04 - 169.02) / 0.1 = -19.82
  D = Kd × 변화율
  D = 0.5 × -19.82 = -9.91
  → 오차가 감소 중 (온도가 가까워짐, 브레이크!)

[Step 2-4] PID 최종 출력
  output = P + I + D
  output = 835.18 + 8.55 + -9.91 = 833.82

[Step 3] 히터 출력 제한
  원래 출력: 833.82
  제한 후: 100.00% (0~100% 범위)
  ⚠️ 100%를 초과해서 100%로 제한됨

[Step 4] 온도 변화
  가열량 = 히터출력 / 열용량
  가열량 = 100.00 / 5.0 = 20.00 °C/초
  냉각량 = 냉각속도 × (현재온도 - 주변온도)
  냉각량 = 0.03 × (32.96 - 25) = 0.24 °C/초
  순변화 = (가열 - 냉각) × 시간
  순변화 = (20.00 - 0.24) × 0.1 = 1.98°C
  새 온도 = 32.96 + 1.98 = 34.94°C

[기여도 분석]
  P항: 97.8%
  I항: 1.0%
  D항: 1.2%
  D항: 1.2%
  D항: 1.2%
  D항: 1.2%

  D항: 1.2%

  D항: 1.2%

→ 다음 반복으로 이동...
  D항: 1.2%
  D항: 1.2%

  D항: 1.2%
  D항: 1.2%

→ 다음 반복으로 이동...

================================================================================
5번 반복 완료!
================================================================================
최종 온도: 34.94°C (목표: 200°C)
남은 오차: 165.06°C

이런 식으로 3000번 반복하면 목표 온도에 도달합니다!
PS C:\coding study> & "C:/Program Files/Python313/python.exe" "c:/coding study/pid_output_unit.py"
======================================================================
PID Output의 단위 분석
======================================================================

[예제 1] 큰 게인값 사용
----------------------------------------------------------------------
Kp = 5.0 (단위: %/°C)
Ki = 0.1 (단위: %/(°C·초))
Kd = 0.5 (단위: %·초/°C)

error = 175°C
P = 5.0 × 175 = 875.0 (단위: %)

integral = 17.5°C·초
I = 0.1 × 17.5 = 1.75 (단위: %)

derivative = 1750°C/초
D = 0.5 × 1750 = 875.0 (단위: %)

output = P + I + D = 1751.75 (단위: %)
⚠️ 하지만 1751.75%는 100%를 초과!
→ np.clip으로 제한: min(1751.75, 100) = 100%

======================================================================
[예제 2] 정규화된 게인값 (0~1 범위 출력)
----------------------------------------------------------------------
Kp = 0.005 (단위: (0~1)/°C)
Ki = 0.0001 (단위: (0~1)/(°C·초))
Kd = 0.0005 (단위: (0~1)·초/°C)

P = 0.005 × 175 = 0.875 (단위: 0~1)
I = 0.0001 × 17.5 = 0.0018 (단위: 0~1)
D = 0.0005 × 1750 = 0.875 (단위: 0~1)

output = 1.7517 (단위: 0~1)
✓ 0~1 범위 내!
→ 퍼센트로 변환: 1.7517 × 100 = 175.17%

======================================================================
[예제 3] 단위 계산 추적
----------------------------------------------------------------------

게인값의 암묵적 단위:
  Kp = 5.0 %/°C
     → error가 1°C 증가하면 output이 5% 증가
  Ki = 0.1 %/(°C·초)
     → 1°C의 오차가 1초 동안 있으면 output이 0.1% 증가
  Kd = 0.5 %·초/°C
     → error가 1°C/초 속도로 변하면 output이 0.5% 변화

실제 계산:
  P = 5.0 %/°C × 175°C = 875%
  I = 0.1 %/(°C·초) × 17.5°C·초 = 1.75%
  D = 0.5 %·초/°C × 1750°C/초 = 875%
  output = 875% + 1.75% + 875% = 1751.75%

물리적 의미:
  → PID가 히터를 1751.75% 출력하라고 요구!
  → 하지만 히터는 최대 100%까지만 가능
  → np.clip(1751.75, 0, 100) = 100%

======================================================================
[예제 4] 목표 온도 근처에서 (190°C)
----------------------------------------------------------------------
현재 온도: 190°C
오차: 10°C (작아짐)

P = 5.0 × 10 = 50.0%
I = 0.1 × 500 = 50.0% (누적됨)
D = 0.5 × -10 = -5.0% (브레이크!)

output = 50.0 + 50.0 + -5.0 = 95.0%
✓ 100% 미만이므로 제한 없음
히터 출력: 95.0%

히터 출력: 95.0%

======================================================================
핵심 정리
히터 출력: 95.0%

======================================================================
히터 출력: 95.0%

히터 출력: 95.0%

히터 출력: 95.0%

히터 출력: 95.0%

======================================================================
히터 출력: 95.0%

히터 출력: 95.0%
히터 출력: 95.0%

======================================================================
핵심 정리
======================================================================
1. output = P + I + D의 단위는 게인값의 단위에 달려있음
2. 보통 게인값을 튜닝해서 output이 '히터 출력 %'가 되도록 조정
3. np.clip으로 0~100% 범위로 제한
4. 실제 히터는 제한된 값(heater_power)을 받음

따라서:
  - output: 제어 신호 (단위는 게인 튜닝에 따라 결정)
  - heater_power: 실제 히터 출력 (단위: %)
PS C:\coding study> & "C:/Program Files/Python313/python.exe" "c:/coding study/PID_trace.py"
================================================================================
PID 게인값 적용 과정 추적
================================================================================
설정: Kp=5.0, Ki=0.1, Kd=0.5
목표 온도: 200°C
초기 온도: 25°C

================================================================================
반복 1 (시간: 0.0초)
================================================================================

[Step 1] 오차 계산
  오차 = 목표(200°C) - 현재(25.00°C) = 175.00°C

[Step 2-1] P항 (비례) 계산
  P = Kp × 오차
  P = 5.0 × 175.00 = 875.00
  → 오차가 크면 큰 출력!

[Step 2-2] I항 (적분) 계산
  누적 오차 = 17.50
  I = Ki × 누적오차
  I = 0.1 × 17.50 = 1.75
  → 과거 오차를 모두 합산!

[Step 2-3] D항 (미분) 계산
  오차 변화율 = (현재 오차 - 이전 오차) / 시간
  오차 변화율 = (175.00 - 0.00) / 0.1 = 1750.00
  D = Kd × 변화율
  D = 0.5 × 1750.00 = 875.00
  → 오차가 증가 중 (온도가 멀어짐)

[Step 2-4] PID 최종 출력
  output = P + I + D
  output = 875.00 + 1.75 + 875.00 = 1751.75

[Step 3] 히터 출력 제한
  원래 출력: 1751.75
  제한 후: 100.00% (0~100% 범위)
  ⚠️ 100%를 초과해서 100%로 제한됨

[Step 4] 온도 변화
  가열량 = 히터출력 / 열용량
  가열량 = 100.00 / 5.0 = 20.00 °C/초
  냉각량 = 냉각속도 × (현재온도 - 주변온도)
  냉각량 = 0.03 × (25.00 - 25) = 0.00 °C/초
  순변화 = (가열 - 냉각) × 시간
  순변화 = (20.00 - 0.00) × 0.1 = 2.00°C
  새 온도 = 25.00 + 2.00 = 27.00°C

[기여도 분석]
  P항: 50.0%
  I항: 0.1%
  D항: 50.0%

→ 다음 반복으로 이동...

================================================================================
반복 2 (시간: 0.1초)
================================================================================

[Step 1] 오차 계산
  오차 = 목표(200°C) - 현재(27.00°C) = 173.00°C

[Step 2-1] P항 (비례) 계산
  P = Kp × 오차
  P = 5.0 × 173.00 = 865.00
  → 오차가 크면 큰 출력!

[Step 2-2] I항 (적분) 계산
  누적 오차 = 34.80
  I = Ki × 누적오차
  I = 0.1 × 34.80 = 3.48
  → 과거 오차를 모두 합산!

[Step 2-3] D항 (미분) 계산
  오차 변화율 = (현재 오차 - 이전 오차) / 시간
  오차 변화율 = (173.00 - 175.00) / 0.1 = -20.00
  D = Kd × 변화율
  D = 0.5 × -20.00 = -10.00
  → 오차가 감소 중 (온도가 가까워짐, 브레이크!)

[Step 2-4] PID 최종 출력
  output = P + I + D
  output = 865.00 + 3.48 + -10.00 = 858.48

[Step 3] 히터 출력 제한
  원래 출력: 858.48
  제한 후: 100.00% (0~100% 범위)
  ⚠️ 100%를 초과해서 100%로 제한됨

[Step 4] 온도 변화
  가열량 = 히터출력 / 열용량
  가열량 = 100.00 / 5.0 = 20.00 °C/초
  냉각량 = 냉각속도 × (현재온도 - 주변온도)
  냉각량 = 0.03 × (27.00 - 25) = 0.06 °C/초
  순변화 = (가열 - 냉각) × 시간
  순변화 = (20.00 - 0.06) × 0.1 = 1.99°C
  새 온도 = 27.00 + 1.99 = 28.99°C

[기여도 분석]
  P항: 98.5%
  I항: 0.4%
  D항: 1.1%

→ 다음 반복으로 이동...

================================================================================
반복 3 (시간: 0.2초)
================================================================================

[Step 1] 오차 계산
  오차 = 목표(200°C) - 현재(28.99°C) = 171.01°C

[Step 2-1] P항 (비례) 계산
  P = Kp × 오차
  P = 5.0 × 171.01 = 855.03
  → 오차가 크면 큰 출력!

[Step 2-2] I항 (적분) 계산
  누적 오차 = 51.90
  I = Ki × 누적오차
  I = 0.1 × 51.90 = 5.19
  → 과거 오차를 모두 합산!

[Step 2-3] D항 (미분) 계산
  오차 변화율 = (현재 오차 - 이전 오차) / 시간
  오차 변화율 = (171.01 - 173.00) / 0.1 = -19.94
  D = Kd × 변화율
  D = 0.5 × -19.94 = -9.97
  → 오차가 감소 중 (온도가 가까워짐, 브레이크!)

[Step 2-4] PID 최종 출력
  output = P + I + D
  output = 855.03 + 5.19 + -9.97 = 850.25

[Step 3] 히터 출력 제한
  원래 출력: 850.25
  제한 후: 100.00% (0~100% 범위)
  ⚠️ 100%를 초과해서 100%로 제한됨

[Step 4] 온도 변화
  가열량 = 히터출력 / 열용량
  가열량 = 100.00 / 5.0 = 20.00 °C/초
  냉각량 = 냉각속도 × (현재온도 - 주변온도)
  냉각량 = 0.03 × (28.99 - 25) = 0.12 °C/초
  순변화 = (가열 - 냉각) × 시간
  순변화 = (20.00 - 0.12) × 0.1 = 1.99°C
  새 온도 = 28.99 + 1.99 = 30.98°C

[기여도 분석]
  P항: 98.3%
  I항: 0.6%
  D항: 1.1%

→ 다음 반복으로 이동...

================================================================================
반복 4 (시간: 0.3초)
================================================================================

[Step 1] 오차 계산
  오차 = 목표(200°C) - 현재(30.98°C) = 169.02°C

[Step 2-1] P항 (비례) 계산
  P = Kp × 오차
  P = 5.0 × 169.02 = 845.09
  → 오차가 크면 큰 출력!

[Step 2-2] I항 (적분) 계산
  누적 오차 = 68.80
  I = Ki × 누적오차
  I = 0.1 × 68.80 = 6.88
  → 과거 오차를 모두 합산!

[Step 2-3] D항 (미분) 계산
  오차 변화율 = (현재 오차 - 이전 오차) / 시간
  오차 변화율 = (169.02 - 171.01) / 0.1 = -19.88
  D = Kd × 변화율
  D = 0.5 × -19.88 = -9.94
  → 오차가 감소 중 (온도가 가까워짐, 브레이크!)

[Step 2-4] PID 최종 출력
  output = P + I + D
  output = 845.09 + 6.88 + -9.94 = 842.03

[Step 3] 히터 출력 제한
  원래 출력: 842.03
  제한 후: 100.00% (0~100% 범위)
  ⚠️ 100%를 초과해서 100%로 제한됨

[Step 4] 온도 변화
  가열량 = 히터출력 / 열용량
  가열량 = 100.00 / 5.0 = 20.00 °C/초
  냉각량 = 냉각속도 × (현재온도 - 주변온도)
  냉각량 = 0.03 × (30.98 - 25) = 0.18 °C/초
  순변화 = (가열 - 냉각) × 시간
  순변화 = (20.00 - 0.18) × 0.1 = 1.98°C
  새 온도 = 30.98 + 1.98 = 32.96°C

[기여도 분석]
  P항: 98.0%
  I항: 0.8%
  D항: 1.2%

→ 다음 반복으로 이동...

================================================================================
반복 5 (시간: 0.4초)
================================================================================

[Step 1] 오차 계산
  오차 = 목표(200°C) - 현재(32.96°C) = 167.04°C

[Step 2-1] P항 (비례) 계산
  P = Kp × 오차
  P = 5.0 × 167.04 = 835.18
  → 오차가 크면 큰 출력!

[Step 2-2] I항 (적분) 계산
  누적 오차 = 85.51
  I = Ki × 누적오차
  I = 0.1 × 85.51 = 8.55
  → 과거 오차를 모두 합산!

[Step 2-3] D항 (미분) 계산
  오차 변화율 = (현재 오차 - 이전 오차) / 시간
  오차 변화율 = (167.04 - 169.02) / 0.1 = -19.82
  D = Kd × 변화율
  D = 0.5 × -19.82 = -9.91
  → 오차가 감소 중 (온도가 가까워짐, 브레이크!)

[Step 2-4] PID 최종 출력
  output = P + I + D
  output = 835.18 + 8.55 + -9.91 = 833.82

[Step 3] 히터 출력 제한
  원래 출력: 833.82
  제한 후: 100.00% (0~100% 범위)
  ⚠️ 100%를 초과해서 100%로 제한됨

[Step 4] 온도 변화
  가열량 = 히터출력 / 열용량
  가열량 = 100.00 / 5.0 = 20.00 °C/초
  냉각량 = 냉각속도 × (현재온도 - 주변온도)
  냉각량 = 0.03 × (32.96 - 25) = 0.24 °C/초
  순변화 = (가열 - 냉각) × 시간
  순변화 = (20.00 - 0.24) × 0.1 = 1.98°C
  새 온도 = 32.96 + 1.98 = 34.94°C

[기여도 분석]
  P항: 97.8%
  I항: 1.0%
  D항: 1.2%

→ 다음 반복으로 이동...

================================================================================
5번 반복 완료!
================================================================================
최종 온도: 34.94°C (목표: 200°C)
남은 오차: 165.06°C

이런 식으로 3000번 반복하면 목표 온도에 도달합니다!
"""
